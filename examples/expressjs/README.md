# Express.js Bedrock Integration Examples

This directory contains complete examples showing how to integrate `auto-bedrock-chat-fastapi` with Express.js applications.

## Files Overview

- **`server.js`** - Complete Express.js server with API endpoints and OpenAPI spec generation
- **`integration.py`** - Python example showing framework-agnostic usage
- **`package.json`** - Node.js dependencies for the Express server
- **`generate-spec.js`** - Standalone script to generate OpenAPI spec
- **`run-demo.sh`** - Quick start script
- **`README.md`** - This documentation

## Quick Start

### 1. Set up the Express.js Server

```bash
# Install Node.js dependencies
cd examples/expressjs/
npm install

# Start the Express server
npm start
```

The server will start on `http://localhost:3000` and automatically:
- Generate an OpenAPI specification from the code annotations
- Save the spec to `api_spec.json`
- Serve Swagger UI documentation at `/api-docs`
- Provide API endpoints for users, products, and orders

### 2. Run the Python Integration Example

```bash
# In another terminal, from the expressjs directory
poetry run python integration.py
```

This will demonstrate:
- Loading the OpenAPI spec generated by the Express server
- Creating a framework-agnostic ToolsGenerator
- Generating AI tools from the Express.js endpoints
- Tool validation and usage examples

## API Endpoints

The Express server provides these endpoints:

### Public API (Available to AI)
- `GET /api/v1/users` - List all users with pagination
- `POST /api/v1/users` - Create a new user
- `GET /api/v1/users/{id}` - Get a specific user
- `GET /api/v1/products` - List products with filtering
- `POST /api/v1/orders` - Create a new order

### Internal API (Excluded from AI)
- `GET /internal/admin/users` - Admin user data (excluded)
- `GET /internal/health` - Health check (excluded)

### Documentation
- `GET /` - API information and available endpoints
- `GET /api-docs` - Interactive Swagger UI documentation
- `GET /api_spec.json` - Download OpenAPI specification

## Complete Workflow

### 1. Express Server Setup
```javascript
// The server.js automatically:
const swaggerJsdoc = require('swagger-jsdoc');
const specs = swaggerJsdoc(swaggerOptions);

// Saves OpenAPI spec to file
fs.writeFileSync('api_spec.json', JSON.stringify(specs, null, 2));
```

### 2. Python Integration
```python
# Load the generated spec
generator = create_tools_generator_from_spec(
    openapi_spec_file="examples/expressjs/api_spec.json",
    allowed_paths=["/api/v1/users", "/api/v1/products", "/api/v1/orders"],
    excluded_paths=["/internal"],
)

# Generate AI tools
tools_desc = generator.generate_tools_desc()
```

### 3. Bedrock AI Usage
The generated tools can be used with AWS Bedrock for AI chat capabilities:
- "Show me all users" → Calls `get_api_v1_users`
- "Create a user named John" → Calls `post_api_v1_users`
- "List products under $50" → Calls `get_api_v1_products` with price filter

## Example API Calls

### Get Users
```bash
curl "http://localhost:3000/api/v1/users?limit=5&offset=0"
```

### Create User
```bash
curl -X POST "http://localhost:3000/api/v1/users" \
  -H "Content-Type: application/json" \
  -d '{"name": "John Doe", "email": "john@example.com", "age": 30}'
```

### Get Products
```bash
curl "http://localhost:3000/api/v1/products?category=Electronics&max_price=50"
```

### Create Order
```bash
curl -X POST "http://localhost:3000/api/v1/orders" \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": 1,
    "items": [{"product_id": 1, "quantity": 2}],
    "shipping_address": {
      "street": "123 Main St",
      "city": "Anytown",
      "state": "CA",
      "zip_code": "12345"
    }
  }'
```

## Configuration

The Python integration automatically detects the API base URL from the OpenAPI spec, but you can also configure it manually:

```python
# Environment variables (.env file)
BEDROCK_API_BASE_URL=http://localhost:3000
BEDROCK_ALLOWED_PATHS=/api/v1/users,/api/v1/products,/api/v1/orders
BEDROCK_EXCLUDED_PATHS=/internal,/admin
```

## Development Mode

For development with auto-reload:

```bash
# Install nodemon for auto-restart
npm install -g nodemon

# Start in dev mode
npm run dev
```

## Production Considerations

1. **Security**: Remove or secure internal endpoints in production
2. **Validation**: Add proper input validation and sanitization
3. **Database**: Replace in-memory storage with a real database
4. **Authentication**: Add authentication/authorization middleware
5. **Rate Limiting**: Implement rate limiting for API endpoints
6. **Monitoring**: Add logging and monitoring capabilities

## Integration Benefits

- **Framework Agnostic**: Works with any framework that can generate OpenAPI specs
- **Auto-discovery**: Automatically detects API endpoints and creates AI tools
- **Type Safety**: Full OpenAPI schema validation for requests/responses
- **Selective Exposure**: Fine-grained control over which endpoints are available to AI
- **Production Ready**: Environment-based configuration and robust error handling