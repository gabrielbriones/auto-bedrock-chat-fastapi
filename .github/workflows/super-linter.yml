name: Super Linter

on:
  push:
    branches:
      - main
      - dev
      - develop
  pull_request:
    branches:
      - main
      - dev
      - develop
  workflow_dispatch:

permissions:
  contents: read
  statuses: write
  checks: write
  pull-requests: write

jobs:
  super-linter:
    name: Run Super Linter
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Run Super Linter
        uses: super-linter/super-linter@v5.0.0
        env:
          DEFAULT_BRANCH: main
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          
          # General Settings
          RUN_LOCAL: false
          USE_FIND_ALGORITHM: true
          LOG_LEVEL: INFO
          VALIDATE_ALL_CODEBASE: true
          
          # Python Linting
          VALIDATE_PYTHON_BLACK: true
          VALIDATE_PYTHON_FLAKE8: true
          VALIDATE_PYTHON_ISORT: true
          VALIDATE_PYTHON_MYPY: true
          VALIDATE_PYTHON_PYLINT: false
          
          # Markdown & Documentation
          VALIDATE_MARKDOWN: true
          MARKDOWN_CONFIG_FILE: .markdownlint.json
          
          # Docker
          VALIDATE_DOCKERFILE_HADOLINT: true
          DOCKERFILE_HADOLINT_FILE_NAME: Dockerfile
          
          # Web
          VALIDATE_HTML: true
          VALIDATE_CSS: true
          VALIDATE_JAVASCRIPT_STANDARD: true
          VALIDATE_JSON: true
          VALIDATE_YAML: true
          
          # Disable less critical checks
          VALIDATE_JSCPD: false
          VALIDATE_GITLEAKS: false
          VALIDATE_CHECKOV: false
          VALIDATE_TERRAFORM: false
          VALIDATE_KOTLIN: false
          VALIDATE_BASH: true
          VALIDATE_SHELL_SHFMT: false
          
          # Performance
          PARALLEL_PROCESSES: 2

      - name: Upload reports to GitHub
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: super-linter-reports
          path: |
            report
            super-linter.log
          if-no-files-found: ignore

      - name: Comment PR with results
        if: github.event_name == 'pull_request' && always()
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const logFile = 'super-linter.log';
            
            if (fs.existsSync(logFile)) {
              const logs = fs.readFileSync(logFile, 'utf8');
              const summary = logs.split('\n').filter(line => 
                line.includes('WARN') || line.includes('ERROR') || line.includes('INFO')
              ).slice(-10).join('\n');
              
              github.rest.issues.createComment({
                issue_number: context.issue.number,
                owner: context.repo.owner,
                repo: context.repo.repo,
                body: `## ğŸ” Super Linter Results\n\n\`\`\`\n${summary}\n\`\`\``
              });
            }
